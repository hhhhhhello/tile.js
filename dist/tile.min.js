/*! tile 12-03-2015 */
!function(a){"use strict";function b(a){this.layers=[];var b=this;this.renderLayer=function(c){if("tilelayer"===c.type&&c.opacity){var d=a.canvas.cloneNode(),e=b.data.tilewidth;d=d.getContext("2d"),b.layers.length<b.data.layers.length?(c.data.forEach(function(a,f){if(a){var g,h,i,j,k=b.data.tilesets[0];a--,g=a%(k.imagewidth/e)*e,h=~~(a/(k.imagewidth/e))*e,i=f%c.width*e,j=~~(f/c.width)*e,d.drawImage(b.tileset,g,h,e,e,i,j,e,e)}}),b.layers.push(d.canvas.toDataURL()),a.drawImage(d.canvas,0,0)):b.layers.forEach(function(b){var c=document.createElement("img");c.src=b,a.drawImage(c,0,0)})}},this.renderLayers=function(a){function b(a){var b=typeof a;return"array"===b}a=b(a)?a:this.data.layers,a.forEach(this.renderLayer)},this.loadTileset=function(a){var b=this;this.data=a,this.tileset=document.createElement("img"),this.tileset.src=a.tilesets[0].image,this.tileset.onload=function(){b.renderLayers(b.tileset)}},this.load=function(a){var b=this;d("./images/"+a+".json",function(a){b.loadTileset(JSON.parse(a))})}}var c=function(){return!0},d=function(a,b){var c=new XMLHttpRequest;c.onreadystatechange=function(){4===c.readyState&&b(c.responseText)},c.open("GET",a,!0),c.send(null)};c.Scene=b,c.VERSION="0.0.0",a.tile=c}(this);